# ================================
# Kanban Auth System - API Examples
# ================================
# Use VS Code REST Client extension ou Postman

# ================================
# VARIÁVEIS
# ================================
@baseUrl = http://localhost:3000
@adminToken = SEU_ADMIN_TOKEN_AQUI
@memberToken = SEU_MEMBER_TOKEN_AQUI

# ================================
# HEALTH CHECK
# ================================
GET {{baseUrl}}/health

# ================================
# 1. AUTENTICAÇÃO
# ================================

### 1.1 Registrar ADMIN
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "name": "Admin Principal",
  "email": "admin@kanban.com",
  "password": "admin123",
  "role": "ADMIN"
}

### 1.2 Registrar MEMBER
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "name": "João Desenvolvedor",
  "email": "joao@kanban.com",
  "password": "joao123",
  "role": "MEMBER"
}

### 1.3 Registrar outro MEMBER
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "name": "Maria Designer",
  "email": "maria@kanban.com",
  "password": "maria123",
  "role": "MEMBER"
}

### 1.4 Login como ADMIN
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "admin@kanban.com",
  "password": "admin123"
}

### 1.5 Login como MEMBER
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "joao@kanban.com",
  "password": "joao123"
}

### 1.6 Refresh Token
POST {{baseUrl}}/api/auth/refresh
Content-Type: application/json

{
  "refreshToken": "{{$dotenv REFRESH_TOKEN}}"
}

### 1.7 Logout
POST {{baseUrl}}/api/auth/logout
Content-Type: application/json

{
  "refreshToken": "{{$dotenv REFRESH_TOKEN}}"
}

# ================================
# 2. TASKS (ADMIN)
# ================================

### 2.1 Criar Task (ADMIN only)
POST {{baseUrl}}/api/tasks
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "title": "Implementar autenticação JWT",
  "description": "Criar sistema completo de auth com access e refresh tokens",
  "assignedTo": 2
}

### 2.2 Criar Task sem atribuição
POST {{baseUrl}}/api/tasks
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "title": "Configurar CI/CD",
  "description": "GitHub Actions para deploy automático"
}

### 2.3 Listar todas as Tasks (ADMIN)
GET {{baseUrl}}/api/tasks
Authorization: Bearer {{adminToken}}

### 2.4 Buscar Task por ID
GET {{baseUrl}}/api/tasks/1
Authorization: Bearer {{adminToken}}

### 2.5 Atualizar Task (ADMIN only)
PUT {{baseUrl}}/api/tasks/1
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "title": "Implementar autenticação JWT completa",
  "description": "Sistema com refresh token rotation e rate limiting",
  "assignedTo": 2
}

### 2.6 Deletar Task (ADMIN only)
DELETE {{baseUrl}}/api/tasks/1
Authorization: Bearer {{adminToken}}

# ================================
# 3. MOVIMENTAÇÃO DE TASKS
# ================================

### 3.1 MEMBER: BACKLOG → IN_PROGRESS (✅ Permitido)
PATCH {{baseUrl}}/api/tasks/1/move
Authorization: Bearer {{memberToken}}
Content-Type: application/json

{
  "newStatus": "IN_PROGRESS"
}

### 3.2 MEMBER: IN_PROGRESS → REVIEW (✅ Permitido)
PATCH {{baseUrl}}/api/tasks/1/move
Authorization: Bearer {{memberToken}}
Content-Type: application/json

{
  "newStatus": "REVIEW"
}

### 3.3 MEMBER: REVIEW → DONE (❌ NEGADO - Apenas ADMIN)
PATCH {{baseUrl}}/api/tasks/1/move
Authorization: Bearer {{memberToken}}
Content-Type: application/json

{
  "newStatus": "DONE"
}

### 3.4 ADMIN: REVIEW → DONE (✅ Aprovação)
PATCH {{baseUrl}}/api/tasks/1/move
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newStatus": "DONE"
}

### 3.5 ADMIN: REVIEW → IN_PROGRESS (✅ Rejeição)
PATCH {{baseUrl}}/api/tasks/1/move
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newStatus": "IN_PROGRESS"
}

### 3.6 ADMIN: Qualquer transição permitida
PATCH {{baseUrl}}/api/tasks/1/move
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newStatus": "BACKLOG"
}

# ================================
# 4. USUÁRIOS (ADMIN only)
# ================================

### 4.1 Listar Usuários (ADMIN only)
GET {{baseUrl}}/api/users
Authorization: Bearer {{adminToken}}

### 4.2 Buscar Usuário por ID
GET {{baseUrl}}/api/users/2
Authorization: Bearer {{adminToken}}

### 4.3 Atualizar Usuário (ADMIN only)
PUT {{baseUrl}}/api/users/2
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "name": "João Silva Desenvolvedor",
  "role": "ADMIN"
}

### 4.4 Deletar Usuário (ADMIN only)
DELETE {{baseUrl}}/api/users/3
Authorization: Bearer {{adminToken}}

# ================================
# 5. CENÁRIOS DE ERRO
# ================================

### 5.1 Login com credenciais inválidas
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "admin@kanban.com",
  "password": "senhaerrada"
}

### 5.2 MEMBER tenta criar Task (403)
POST {{baseUrl}}/api/tasks
Authorization: Bearer {{memberToken}}
Content-Type: application/json

{
  "title": "Tentativa de criar task",
  "description": "Não deveria funcionar"
}

### 5.3 MEMBER tenta mover task de outro (403)
PATCH {{baseUrl}}/api/tasks/2/move
Authorization: Bearer {{memberToken}}
Content-Type: application/json

{
  "newStatus": "IN_PROGRESS"
}

### 5.4 Transição inválida (400)
PATCH {{baseUrl}}/api/tasks/1/move
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newStatus": "DONE"
}

### 5.5 Token expirado (401)
GET {{baseUrl}}/api/tasks
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.expired

### 5.6 Sem token (401)
GET {{baseUrl}}/api/tasks

# ================================
# 6. FLUXO COMPLETO DE UMA TASK
# ================================

### 6.1 ADMIN cria task
POST {{baseUrl}}/api/tasks
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "title": "Implementar dashboard",
  "description": "Dashboard com métricas de tasks",
  "assignedTo": 2
}

### 6.2 MEMBER visualiza suas tasks
GET {{baseUrl}}/api/tasks
Authorization: Bearer {{memberToken}}

### 6.3 MEMBER move para IN_PROGRESS
PATCH {{baseUrl}}/api/tasks/1/move
Authorization: Bearer {{memberToken}}
Content-Type: application/json

{
  "newStatus": "IN_PROGRESS"
}

### 6.4 MEMBER finaliza e move para REVIEW
PATCH {{baseUrl}}/api/tasks/1/move
Authorization: Bearer {{memberToken}}
Content-Type: application/json

{
  "newStatus": "REVIEW"
}

### 6.5 ADMIN revisa e aprova (DONE)
PATCH {{baseUrl}}/api/tasks/1/move
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "newStatus": "DONE"
}

# ================================
# 7. RATE LIMITING
# ================================

### 7.1 Testar rate limit (faça 6 vezes em menos de 15min)
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "teste@teste.com",
  "password": "qualquercoisa"
}

# ================================
# NOTAS
# ================================
# 1. Após login, copie o accessToken e cole em {{adminToken}} ou {{memberToken}}
# 2. Access token expira em 15min
# 3. Refresh token expira em 7 dias
# 4. Toda task nasce em BACKLOG
# 5. DONE é status final (não pode mover)

